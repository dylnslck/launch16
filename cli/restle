#!/usr/bin/env node

const program = require('commander');

const pkg = require('./package.json');
const init = require('./commands/init');
const schema = require('./commands/schema');
const start = require('./commands/start');
const deploy = require('./commands/deploy');
const scale = require('./commands/scale');

program
  .version(pkg.version);

program
  .command('init [dir]')
  .description('scaffolds a Restle application')
  .action(init);

program
  .command('schema <action> <type> [fields...]')
  .alias('schemas')
  .description('manage Restle schemas')
  .action(schema);

program
  .command('start')
  .option('-p, --port <port>', 'the port to run the instance on')
  .description('starts a Restle instance on localhost')
  .action(start);

program
  .command('deploy')
  .description('deploys a Restle instance')
  .action(deploy);

program
  .command('scale <number>')
  .description('scales the currently deployed Restle instance')
  .action(scale);

program.parse(process.argv);

const validCommands = /(init|schemas?|start|deploy|scale)/;
const command = process.argv[2];

if (!command || !validCommands.test(command)) program.help();
